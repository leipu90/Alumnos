<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SuriQuir√≥fano | Seguimiento de Alumnos</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Configuraci√≥n Tailwind -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            medical: {
              50: '#f0fdfa',
              100: '#ccfbf1',
              500: '#14b8a6',
              600: '#0d9488',
              700: '#0f766e',
              800: '#115e59',
              900: '#134e4a'
            }
          }
        }
      }
    }
  </script>

  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f8fafc; }
    .fade-in { animation: fadeIn 0.3s ease-in-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

    input[type=range]::-webkit-slider-thumb {
      -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: #0d9488; cursor: pointer; margin-top: -6px;
    }
    input[type=range]::-webkit-slider-runnable-track {
      width: 100%; height: 4px; cursor: pointer; background: #ccfbf1; border-radius: 2px;
    }
  </style>
</head>
<body class="text-slate-700 h-screen flex flex-col overflow-hidden">

<!-- HEADER -->
<nav class="bg-white border-b border-slate-200 shadow-sm z-10">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between h-16">
      <div class="flex items-center cursor-pointer" onclick="app.renderDashboard()">
        <i class="fa-solid fa-heart-pulse text-medical-600 text-2xl mr-3"></i>
        <span class="font-bold text-xl text-slate-800 tracking-tight">Suri<span class="text-medical-600">Quir√≥fano</span></span>
      </div>
      <div class="flex items-center space-x-4">
        <span class="text-sm text-slate-500 hidden sm:block">Modo actual:</span>
        <select id="roleSelector" onchange="app.setRole(this.value)" class="bg-slate-50 border border-slate-300 text-slate-900 text-sm rounded-lg focus:ring-medical-500 focus:border-medical-500 block p-2">
          <option value="Docente">üéì Docente</option>
          <option value="Enfermer√≠a">üè• Enfermer√≠a</option>
        </select>
      </div>
    </div>
  </div>
</nav>

<!-- CONTENEDOR PRINCIPAL -->
<main class="flex-1 overflow-y-auto bg-slate-50 p-4 sm:p-8" id="mainContent"></main>

<!-- MODAL -->
<div id="modalOverlay" class="fixed inset-0 bg-slate-900 bg-opacity-50 hidden items-center justify-center z-50 backdrop-blur-sm transition-opacity">
  <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl mx-4 overflow-hidden transform transition-all scale-100">
    <div class="bg-medical-600 px-6 py-4 flex justify-between items-center">
      <h3 class="text-white font-semibold text-lg" id="modalTitle">T√≠tulo Modal</h3>
      <button onclick="app.closeModal()" class="text-medical-100 hover:text-white transition">
        <i class="fa-solid fa-times text-xl"></i>
      </button>
    </div>
    <div class="p-6 max-h-[80vh] overflow-y-auto" id="modalContent"></div>
  </div>
</div>

<!-- FIREBASE -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.4.0/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC68e1yqOg47g7gEgIJTcl4Bi2FUCm4lgM",
    authDomain: "eval-93e9e.firebaseapp.com",
    projectId: "eval-93e9e",
    storageBucket: "eval-93e9e.firebasestorage.app",
    messagingSenderId: "467067668263",
    appId: "1:467067668263:web:f9f87624b2b6f3612f8b02"
  };

  const appFirebase = initializeApp(firebaseConfig);
  const db = getFirestore(appFirebase);

  export async function saveEvaluationFirebase(studentId, evaluation) {
    await addDoc(collection(db, "evaluaciones"), {
      studentId,
      ...evaluation
    });
  }

  export async function loadEvaluationsFirebase() {
    const snapshot = await getDocs(collection(db, "evaluaciones"));
    return snapshot.docs.map(doc => doc.data());
  }
</script>

<!-- JAVASCRIPT LOGIC -->
<script>
const app = (() => {
  const state = {
    students: [],
    currentUserRole: 'Docente',
    currentStudentId: null,
    chartInstance: null
  };

  const criteriaList = [
    { key: 'asepsia', label: 'Asepsia y Antisepsia' },
    { key: 'area', label: 'Conocimiento √Årea Quir√∫rgica' },
    { key: 'instrumentacion', label: 'Instrumentaci√≥n Quir√∫rgica' },
    { key: 'seguridad', label: 'Seguridad del Paciente' },
    { key: 'equipo', label: 'Trabajo en Equipo y Comunicaci√≥n' },
    { key: 'etica', label: 'Responsabilidad y √âtica' },
    { key: 'autonomia', label: 'Autonom√≠a Progresiva' }
  ];

  function init() {
    loadData();
    renderDashboard();
    if (state.students.length === 0) loadMockData();
  }

  function loadData() {
    const stored = localStorage.getItem('suri_students');
    if (stored) state.students = JSON.parse(stored);
  }

  function saveData() {
    localStorage.setItem('suri_students', JSON.stringify(state.students));
  }

  function loadMockData() {
    const today = new Date();
    const pastDate = new Date();
    pastDate.setDate(today.getDate() - 15);

    const mockStudents = [
      {
        id: 'ALU-001',
        name: 'Ana Garc√≠a L√≥pez',
        dni: '12345678A',
        course: 'Pr√°cticas II',
        startDate: '2023-09-01',
        evaluations: [
          { id: 1, date: pastDate.toISOString().split('T')[0], evaluator: 'Docente', evaluatorName: 'Dr. Mart√≠nez', scores: { asepsia: 5, area: 6, instrumentacion: 4, seguridad: 7, equipo: 8, etica: 9, autonomia: 4 }, average: 6.1, observations: 'Inicio titubeante, buena actitud.' },
          { id: 2, date: today.toISOString().split('T')[0], evaluator: 'Enfermer√≠a', evaluatorName: 'Enf. Ruiz', scores: { asepsia: 8, area: 8, instrumentacion: 7, seguridad: 8, equipo: 9, etica: 9, auton
